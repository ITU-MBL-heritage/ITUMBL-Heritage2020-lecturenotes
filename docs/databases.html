<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Databases | MBL617 Theory and Methods in Digital Heritage</title>
  <meta name="description" content="MBL617 Lecture Notes" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Databases | MBL617 Theory and Methods in Digital Heritage" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="MBL617 Lecture Notes" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Databases | MBL617 Theory and Methods in Digital Heritage" />
  
  <meta name="twitter:description" content="MBL617 Lecture Notes" />
  

<meta name="author" content="Özgün Balaban Güzden Varinlioğlu" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="creating-data.html"/>
<link rel="next" href="assignment.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MBL617 Theory and Methods in Digital Heritage</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Syllabus</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#content"><i class="fa fa-check"></i><b>1.1</b> Content</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#aims"><i class="fa fa-check"></i><b>1.2</b> Aims</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#learning-outcomes"><i class="fa fa-check"></i><b>1.3</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#conduct"><i class="fa fa-check"></i><b>1.4</b> Conduct</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#project"><i class="fa fa-check"></i><b>1.5</b> Project</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#weekly-schedule"><i class="fa fa-check"></i><b>1.6</b> Weekly Schedule</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quick-start-to-qgis.html"><a href="quick-start-to-qgis.html"><i class="fa fa-check"></i><b>2</b> Quick Start to QGIS</a><ul>
<li class="chapter" data-level="2.1" data-path="quick-start-to-qgis.html"><a href="quick-start-to-qgis.html#installing-qgis"><i class="fa fa-check"></i><b>2.1</b> Installing QGIS</a></li>
<li class="chapter" data-level="2.2" data-path="quick-start-to-qgis.html"><a href="quick-start-to-qgis.html#familiarizing-yourself-with-qgis-desktop"><i class="fa fa-check"></i><b>2.2</b> Familiarizing yourself with QGIS Desktop</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vector-data.html"><a href="vector-data.html"><i class="fa fa-check"></i><b>3</b> Vector Data</a><ul>
<li class="chapter" data-level="3.1" data-path="vector-data.html"><a href="vector-data.html#types-of-vector-data-in-qgis"><i class="fa fa-check"></i><b>3.1</b> Types of vector data in QGIS</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="raster-data.html"><a href="raster-data.html"><i class="fa fa-check"></i><b>4</b> Raster Data</a><ul>
<li class="chapter" data-level="4.1" data-path="raster-data.html"><a href="raster-data.html#crs---coordinate-reference-systems"><i class="fa fa-check"></i><b>4.1</b> CRS - Coordinate Reference Systems</a></li>
<li class="chapter" data-level="4.2" data-path="raster-data.html"><a href="raster-data.html#raster-file-types"><i class="fa fa-check"></i><b>4.2</b> Raster File types</a><ul>
<li class="chapter" data-level="4.2.1" data-path="raster-data.html"><a href="raster-data.html#wms"><i class="fa fa-check"></i><b>4.2.1</b> WMS</a></li>
<li class="chapter" data-level="4.2.2" data-path="raster-data.html"><a href="raster-data.html#dem---digital-elevation-model"><i class="fa fa-check"></i><b>4.2.2</b> DEM - Digital Elevation Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="d-maps.html"><a href="d-maps.html"><i class="fa fa-check"></i><b>5</b> 3D Maps</a></li>
<li class="chapter" data-level="6" data-path="styling-data.html"><a href="styling-data.html"><i class="fa fa-check"></i><b>6</b> Styling Data</a><ul>
<li class="chapter" data-level="6.1" data-path="styling-data.html"><a href="styling-data.html#points"><i class="fa fa-check"></i><b>6.1</b> Points</a></li>
<li class="chapter" data-level="6.2" data-path="styling-data.html"><a href="styling-data.html#polylines"><i class="fa fa-check"></i><b>6.2</b> Polylines</a></li>
<li class="chapter" data-level="6.3" data-path="styling-data.html"><a href="styling-data.html#polygons"><i class="fa fa-check"></i><b>6.3</b> Polygons</a></li>
<li class="chapter" data-level="6.4" data-path="styling-data.html"><a href="styling-data.html#raster"><i class="fa fa-check"></i><b>6.4</b> Raster</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="printing-maps.html"><a href="printing-maps.html"><i class="fa fa-check"></i><b>7</b> Printing Maps</a></li>
<li class="chapter" data-level="8" data-path="creating-data.html"><a href="creating-data.html"><i class="fa fa-check"></i><b>8</b> Creating Data</a></li>
<li class="chapter" data-level="9" data-path="databases.html"><a href="databases.html"><i class="fa fa-check"></i><b>9</b> Databases</a><ul>
<li class="chapter" data-level="9.1" data-path="databases.html"><a href="databases.html#connection-to-postgis-using-ssl"><i class="fa fa-check"></i><b>9.1</b> Connection to POSTGIS using SSL</a></li>
<li class="chapter" data-level="9.2" data-path="databases.html"><a href="databases.html#introduction-to-postgis"><i class="fa fa-check"></i><b>9.2</b> Introduction to POSTGIS</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="assignment.html"><a href="assignment.html"><i class="fa fa-check"></i><b>10</b> Assignment</a><ul>
<li class="chapter" data-level="10.1" data-path="assignment.html"><a href="assignment.html#collecting-the-data-creating-the-layer"><i class="fa fa-check"></i><b>10.1</b> Collecting the data &amp; Creating the layer</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MBL617 Theory and Methods in Digital Heritage</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="databases" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Databases</h1>
<div id="connection-to-postgis-using-ssl" class="section level2">
<h2><span class="header-section-number">9.1</span> Connection to POSTGIS using SSL</h2>
<p>QGIS has an ability to connect to various different databases. Geopackage, Oracle Spatial, PostGIS, SpatiaLite.</p>
<div class="figure">
<img src="Images/databases.png" alt="Databases that can be connected through QGIS" />
<p class="caption">Databases that can be connected through QGIS</p>
</div>
<p>We are going to use PostGIS in our projects.</p>
<blockquote>
<p>PostGIS is the geographic extension of the database management system, PostgreSQL, which allows us to store geographic objects as part of our data tables. A geographic object is a special type of data that allows us to store a geographic position or a set of them as part of a line or a polygon. Essentially, PostGIS is a powerful tool that enables you to handle complex geographical data and visually explore this data when you use it along with graphical tools, such as QGIS.</p>
</blockquote>
<p>We will be hosting our PostGIS database using Google Cloud.To access it we need to connect using SSL. (However, the eduroam connection in the campus prevents us to use the port 5432 which is the usual postgreSQL port so we need to use out of the ITU network)</p>
<p>To connect you will need to download 3 certificate files. server-ca.pem, client-cert.pem, client-key.pem. Download these files and place them to a folder that is accesible.</p>
<p>From processing toolbox click the right most icon, <strong>options</strong>.</p>
<p>From the menu select <strong>Authentication</strong>.</p>
<div class="figure">
<img src="Images/ManageCertificates.png" alt="Manage Certificates" />
<p class="caption">Manage Certificates</p>
</div>
<p>And next select <strong>manage certificates</strong>.</p>
<p>Here from the authorities tab, click + to add Google Cloud certificate.</p>
<div class="figure">
<img src="Images/certificatemanager.png" alt="Certificate Manager" />
<p class="caption">Certificate Manager</p>
</div>
<p>Here from the import certificate menu, click … icon and locate your server-ca.pem file.</p>
<div class="figure">
<img src="Images/importcertificate.png" alt="Import Certificate" />
<p class="caption">Import Certificate</p>
</div>
<p>Back from the certificate manager screen click to the identities tab and click + icon.</p>
<div class="figure">
<img src="Images/importIdentity.png" alt="Import Identities" />
<p class="caption">Import Identities</p>
</div>
<p>From the import identity screen, select PKI PEM/DER Certificate Paths. For cert select client-cert.pem and for key select client-key.pem.</p>
<p>Next, close the identity screen and from the Authentication screen click + icon.</p>
<div class="figure">
<img src="Images/authentication.png" alt="Authentication window" />
<p class="caption">Authentication window</p>
</div>
<p>From the dialogue box, select PKI stored identity certificate, and select the certificate that you have created (editor). write a name (eg. Google Cloud) and save.</p>
<div class="figure">
<img src="Images/authentication2.png" alt="Authentication Dialogue Box" />
<p class="caption">Authentication Dialogue Box</p>
</div>
<p>Now close the windows and from the browser panel select PostGIS and right click and select new connection.</p>
<div class="figure">
<img src="Images/postgisServer.png" alt="PostGIS server settings" />
<p class="caption">PostGIS server settings</p>
</div>
<p>Here you need to enter information required to setup a connection to our server. Fill out the information as following:</p>
<div class="figure">
<img src="Images/postGISinfo.png" alt="PostGIS information" />
<p class="caption">PostGIS information</p>
</div>
<p>The username and password for our database is <strong>editor</strong> and <strong>123post</strong>. After this step we will be connected to the server.</p>
<p>Server connections work similar to the layers. If you have a geospatial data you can import or export to the database.</p>
<p>For this project, we need to have a database of caravanserais as point geometries and we need topography information as vector layer.</p>
</div>
<div id="introduction-to-postgis" class="section level2">
<h2><span class="header-section-number">9.2</span> Introduction to POSTGIS</h2>
<p>After connecting to the database, you can see our two tables iran_han and turk_han on the left side of the screen.</p>
<div class="figure">
<img src="Images/postgisConnection.png" alt="PostGIS Connection" />
<p class="caption">PostGIS Connection</p>
</div>
<p>POSTGIS database uses SQL Structured Query Language , to create the table turk_han I used the following SQL query (Showing this for you as a reference you dont need to do this, I already created our tables.)</p>
<pre><code>CREATE TABLE turk_han  ( id serial, 
common_names character(30),  
alternative_names character(100), 
village character(30), 
district character(30), 
province character(30), 
date character(30), 
reference varchar, 
layer character(10),  
the_geom geometry,    
CONSTRAINT turk_pkey PRIMARY KEY (id)  );</code></pre>
<p>To insert a new feature/han we need to run a sql query. Below you can see an example feature.</p>
<pre><code>INSERT INTO turk_han (common_names, 
alternative_names, 
village, 
district, 
province, 
date, 
reference, 
layer, 
the_geom) 
VALUES (&#39;Alacahan Kervansarayı&#39;, NULL, &#39;Alacahan&#39;, &#39;Kangal&#39;, &#39;Sivas&#39;, &#39;1150-1180&#39;, NULL, &#39;VAR&#39;, ST_GeomFromEWKT(&#39;SRID=4326;POINT(37.5975095 39.1058708)&#39;));</code></pre>
<p>To update data you need to first find the id of the feature that you want to change. For this you can use SELECT query.</p>
<pre><code>SELECT * FROM turk_han
WHERE common_name = &#39;Alacahan Kervansarayı&#39;</code></pre>
<p>For example this query brings all the entries that has common_name as Alacahan Kervansarayı. For example, to update its location you can use the query below.</p>
<pre><code>UPDATE turk_han
SET the_geom = ST_GeomFromEWKT(&#39;SRID=4326;POINT(37.5975095 39.10587)&#39;)
WHERE
    id = 4;</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="creating-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="assignment.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/08-Database.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
